/*
 0BSD
*/
(function(){function p(c){var f;for(f=c.length-1;0<=f;--f){var g=f;++c[g];if(0!==c[g])break}}function h(c,f,g,e,h){function k(a){null==a&&(a=null);if(!(this instanceof k))return new k(a);null===a&&(a=n(48));this.b=a;this.a=new Uint8Array(12)}function l(a,b){if(!(this instanceof l))return new l(a,b);a?(this.a=e.HandshakeState(q,e.constants.NOISE_ROLE_INITIATOR),this.a.Initialize(null,null,b)):(this.a=e.HandshakeState(q,e.constants.NOISE_ROLE_RESPONDER),this.a.Initialize(null,b))}k.prototype={get_key:function(){return this.b},
wrap:function(a){p(this.a);return g.encrypt(a,new Uint8Array(0),this.a,this.b,0)},unwrap:function(a){p(this.a);return g.decrypt(a,new Uint8Array(0),this.a,this.b,0)}};Object.defineProperty(k.prototype,"constructor",{value:k});l.prototype={ready:function(){return!this.a},get_handshake_message:function(){var a=null;this.a&&(this.a.GetAction()===e.constants.NOISE_ACTION_WRITE_MESSAGE&&(a=this.a.WriteMessage()),this.f());return a},put_handshake_message:function(a){this.a&&(this.a.GetAction()===e.constants.NOISE_ACTION_READ_MESSAGE&&
this.a.ReadMessage(a),this.f())},f:function(){var a=this.a.GetAction();if(a===e.constants.NOISE_ACTION_SPLIT){a=this.a.Split();this.c=a[0];this.b=a[1];a=new Uint8Array(0);var b=new Uint8Array(32);this.h=this.c.EncryptWithAd(a,b);this.g=this.b.EncryptWithAd(a,b);delete this.a}else if(a===e.constants.NOISE_ACTION_FAILED)throw delete this.a,Error("Noise handshake failed");},get_rewrapper_keys:function(){return[this.h,this.g]},encrypt:function(a){return this.c.EncryptWithAd(new Uint8Array(0),a)},decrypt:function(a){return this.b.DecryptWithAd(new Uint8Array(0),
a)},destroy:function(){this.a&&this.a.free();this.c&&this.c.free();this.b&&this.b.free()}};Object.defineProperty(l.prototype,"constructor",{value:l});return{ready:function(a){g.ready(function(){h.ready(function(){f.ready(function(){e.ready(function(){c.ready(function(){a()})})})})})},create_keypair:function(a){null==a&&(a=null);a||(a=c.createSeed());var b=c.createKeyPair(a);return{seed:a,ed25519:{"public":b.publicKey,"private":b.secretKey},x25519:{"public":f.convert_public_key(b.publicKey),"private":f.convert_private_key(a)}}},
convert_public_key:function(a){return f.convert_public_key(a)},sign:function(a,b,d){return c.sign(a,b,d)},verify:function(a,b,d){return c.verify(a,b,d)},Rewrapper:k,Encryptor:l,one_way_encrypt:function(a,b){var d=e.HandshakeState(r,e.constants.NOISE_ROLE_INITIATOR);d.Initialize(null,null,a);a=d.WriteMessage();var c=d.Split();d=c[0];c=c[1];b=d.EncryptWithAd(new Uint8Array(0),b);d.free();c.free();d=new Uint8Array(m+b.length);d.set(a);d.set(b,m);return d},one_way_decrypt:function(a,b){var d=b.subarray(0,
m);b=b.subarray(m);var c=e.HandshakeState(r,e.constants.NOISE_ROLE_RESPONDER);c.Initialize(null,a);c.ReadMessage(d);d=c.Split();a=d[0];d=d[1];b=d.DecryptWithAd(new Uint8Array(0),b);a.free();d.free();return b},blake2b_256:function(a){return h.Blake2b(32).update(a)["final"]()}}}var n;"object"===typeof exports?n=require("crypto").randomBytes:n=function(c){c=new Uint8Array(c);crypto.getRandomValues(c);return c};var q="Noise_NK_25519_ChaChaPoly_BLAKE2b";var r="Noise_N_25519_ChaChaPoly_BLAKE2b";var m=48;
"function"===typeof define&&define.amd?define(["supercop.wasm","ed25519-to-x25519.wasm","aez.wasm","noise-c.wasm","blake2.wasm"],h):"object"===typeof exports?module.exports=h(require("supercop.wasm"),require("ed25519-to-x25519.wasm"),require("aez.wasm"),require("noise-c.wasm"),require("blake2.wasm")):this.detox_crypto=h(this.supercop_wasm,this.ed25519_to_x25519_wasm,this.aez_wasm,this.noise_c_wasm,this.blake2_wasm)}).call(this);