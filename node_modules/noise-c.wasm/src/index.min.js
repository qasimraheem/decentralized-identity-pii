(function(){var e;function t(t,n){var r,s;function _(e,n){var r,_;return r=s(),t._NoiseBuffer_create(r,e,n,e.length),_=r.dereference(),r.free(),_}function i(e,t){var r,s;if(e!==n.NOISE_ERROR_NONE)for(r in s=n)if(s[r]===e){if(t)try{t.free()}catch(e){}throw new Error(r)}}function a(e){var n;if(!(this instanceof a))return new a(e);n=s(),i(t._noise_cipherstate_new_by_id(n,e),n),this._state=n.dereference(),this._mac_length=t._noise_cipherstate_get_mac_length(this._state),n.free()}function h(e){this._state=e,this._mac_length=t._noise_cipherstate_get_mac_length(this._state)}function o(e){var n,_=this;if(!(this instanceof o))return new o(e);n=s(),e=r(0,e),i(t._noise_symmetricstate_new_by_name(n,e),n),this._state=n.dereference(),n.free(),e.free(),Object.defineProperty(this,"_mac_length",{configurable:!0,get:function(){var e;return(e=t._noise_symmetricstate_get_mac_length(_._state))>0&&(_._mac_length=e),e}})}function c(e,n){var _,a;if(!(this instanceof c))return new c(e,n);_=s(),e=r(0,e),a=t._noise_handshakestate_new_by_name(_,e,n),e.free(),i(a,_),this._state=_.dereference(),_.free()}return(t=t())._random_bytes=e,r=t.allocateBytes,s=t.allocatePointer,a.prototype={InitializeKey:function(e){var n;e=r(0,e),n=t._noise_cipherstate_init_key(this._state,e,e.length),e.free(),i(n,this)},HasKey:function(){return 1===t._noise_cipherstate_has_key(this._state)},EncryptWithAd:function(e,n){var s,a,h;return e=r(0,e),s=_(n=r(n.length+this._mac_length,n),n.length-this._mac_length),a=t._noise_cipherstate_encrypt_with_ad(this._state,e,e.length,s),h=n.get(),e.free(),n.free(),s.free(),i(a),h},DecryptWithAd:function(e,n){var s,a,h;return e=r(0,e),s=_(n=r(0,n),n.length),a=t._noise_cipherstate_decrypt_with_ad(this._state,e,e.length,s),h=n.get().slice(0,n.length-this._mac_length),e.free(),n.free(),s.free(),i(a),h},Rekey:function(){throw"Not implemented"},free:function(){var e;e=t._noise_cipherstate_free(this._state),delete this._state,delete this._mac_length,i(e)}},Object.defineProperty(a.prototype,"constructor",{enumerable:!1,value:a}),h.prototype=Object.create(a.prototype),Object.defineProperty(h.prototype,"constructor",{enumerable:!1,value:h}),o.prototype={MixKey:function(e){var n;e=r(0,e),n=t._noise_symmetricstate_mix_key(this._state,e,e.length),e.free(),i(n,this)},MixHash:function(e){var n;e=r(0,e),n=t._noise_symmetricstate_mix_hash(this._state,e,e.length),e.free(),i(n,this)},MixKeyAndHash:function(e){var n,r,_,i;this.MixKey(e),n=s(),r=t._SymmetricState_get_ck(this._state,n),_=n.dereference(r),n.free(),i=_.get(),_.free(),this.MixHash(i)},EncryptAndHash:function(e){var n,s,a;return n=_(e=r(e.length+this._mac_length,e),e.length-this._mac_length),s=t._noise_symmetricstate_encrypt_and_hash(this._state,n),a=e.get(),e.free(),n.free(),i(s,this),a},DecryptAndHash:function(e){var n,s,a;return n=_(e=r(0,e),e.length),s=t._noise_symmetricstate_decrypt_and_hash(this._state,n),a=e.get().slice(0,e.length-this._mac_length),e.free(),n.free(),i(s,this),a},Split:function(){var e,n,r,_,a,o;e=s(),n=s(),r=t._noise_symmetricstate_split(this._state,e,n);try{i(r)}catch(t){throw _=t,e.free(),n.free(),_}a=new h(e.dereference()),o=new h(n.dereference()),e.free(),n.free();try{this.free()}catch(e){_=e;try{a.free()}catch(e){}try{o.free()}catch(e){}throw _}return[a,o]},free:function(){var e;e=t._noise_symmetricstate_free(this._state),delete this._state,delete this._mac_length,i(e)}},Object.defineProperty(o.prototype,"constructor",{enumerable:!1,value:o}),c.prototype={Initialize:function(e,n,s,_){var a,h;if(null==e&&(e=null),null==n&&(n=null),null==s&&(s=null),null==_&&(_=null),e&&(e=r(0,e),a=t._noise_handshakestate_set_prologue(this._state,e,e.length),e.free(),i(a,this)),_&&1===t._noise_handshakestate_needs_pre_shared_key(this._state)&&(_=r(0,_),a=t._noise_handshakestate_set_pre_shared_key(this._state,_,_.length),_.free(),i(a,this)),1===t._noise_handshakestate_needs_local_keypair(this._state)){if(!n)throw new Error("Local static private key (s) required, but not provided");h=t._noise_handshakestate_get_local_keypair_dh(this._state),n=r(0,n),a=t._noise_dhstate_set_keypair_private(h,n,n.length),n.free(),i(a,this)}if(1===t._noise_handshakestate_needs_remote_public_key(this._state)){if(!s)throw new Error("Remote static public key (rs) required, but not provided");h=t._noise_handshakestate_get_remote_public_key_dh(this._state),s=r(0,s),a=t._noise_dhstate_set_public_key(h,s,s.length),s.free(),i(a,this)}i(a=t._noise_handshakestate_start(this._state),this)},GetAction:function(){return t._noise_handshakestate_get_action(this._state)},FallbackTo:function(e){null==e&&(e=n.NOISE_PATTERN_XX_FALLBACK),i(t._noise_handshakestate_fallback_to(this._state,e),this)},WriteMessage:function(e){var s,a,h,o,c,f,l;null==e&&(e=null),s=r(n.NOISE_MAX_PAYLOAD_LEN),a=_(s,0),h=null,e&&(h=_(e=r(0,e),e.length)),o=t._noise_handshakestate_write_message(this._state,a,h),e&&(e.free(),h.free());try{i(o,this)}catch(e){throw c=e,s.free(),a.free(),c}return f=t._NoiseBuffer_get_size(a),l=s.get().slice(0,f),s.free(),a.free(),l},ReadMessage:function(e,s,a){var h,o,c,f,l,u,d;null==s&&(s=!1),null==a&&(a=!1),h=_(e=r(0,e),e.length),o=null,s&&(c=r(n.NOISE_MAX_PAYLOAD_LEN),o=_(c,c.length)),f=t._noise_handshakestate_read_message(this._state,h,o),e.free(),h.free();try{i(f,a?void 0:this)}catch(e){throw l=e,s&&(c.free(),o.free()),l}return u=null,s&&(d=t._NoiseBuffer_get_size(o),u=c.get().slice(0,d),c.free(),o.free()),u},Split:function(){var e,n,r,_,a,o;e=s(),n=s(),r=t._noise_handshakestate_split(this._state,e,n);try{i(r,this)}catch(t){throw _=t,e.free(),n.free(),_}a=new h(e.dereference()),o=new h(n.dereference()),e.free(),n.free();try{this.free()}catch(e){_=e;try{a.free()}catch(e){}try{o.free()}catch(e){}throw _}return[a,o]},free:function(){var e;e=t._noise_handshakestate_free(this._state),delete this._state,i(e)}},Object.defineProperty(c.prototype,"constructor",{enumerable:!1,value:c}),{ready:t.then,constants:n,CipherState:a,SymmetricState:o,HandshakeState:c,_lib_internal:t}}e="undefined"!=typeof crypto?function(e){var t;return t=new Uint8Array(e),crypto.getRandomValues(t),t}:require("crypto").randomBytes,"function"==typeof define&&define.amd?define(["./noise-c","./constants"],t):"object"==typeof exports?module.exports=t(require("./noise-c"),require("./constants")):this.noise_c_wasm=t(this.__noise_c_wasm,this.__noise_c_wasm_constants)}).call(this);